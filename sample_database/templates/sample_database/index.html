{% extends 'base.html' %} {% block content %}
<div class="table-responsive">
  <table id="sample-table" class="table table-striped table-bordered">
    <thead class="thead-light">
      <tr>
        <th>Sample ID</th>
        <th>Sample Name</th>
        <th>Submitting Lab</th>
        <th>Project</th>
        <th>Date submitted</th>
        <th>Requested services</th>
        <th>Sample Type</th>
        <th>Received</th>
        <th>Latest Workflow Execution</th>
        <th>Date</th>
        <th>Status</th>
      </tr>
    </thead>
    <tfoot>
      <tr>
        <th>Sample ID</th>
        <th>Sample Name</th>
        <th>Submitting Lab</th>
        <th>Project</th>
        <th>Date submitted</th>
        <th>Requested services</th>
        <th>Sample Type</th>
        <th>Received</th>
        <th>Latest Workflow Execution</th>
        <th>Date</th>
        <th>Status</th>
      </tr>
    </tfoot>
  </table>
</div>
{% endblock %} {% block inline_javascript %}
<script type="text/javascript">
  $(document).ready(function () {
    $('#sample-table tfoot th').each(function () {
      var title = $(this).text();
      $(this).html('<input type="text" placeholder="Search ' + title + '" />');
    });

    $('#sample-table').DataTable({
      ajax: {
        url: '/api/sample/',
        dataSrc: '',
      },
      order: [[0, 'desc']],
      lengthMenu: [
        [10, 50, 100, -1],
        [10, 50, 100, 'All'],
      ],
      columns: [
        {
          data: 'sample_id',
          render: function (data, type, row, meta) {
            if (type === 'display') {
              var link = '/sample_database/' + data;
              return '<a href="' + link + '">' + data + '</a>';
            }
            return data;
          },
        },
        { data: 'sample_name' },
        { data: 'submitting_lab' },
        {
          data: null,
          defaultContent: '',
          render: function (data, type, row) {
            var bmh_project = row.bmh_project || '';
            var submitter_project = row.submitter_project || '';
            var project_display = bmh_project;

            if (submitter_project !== '') {
                project_display += ' (' + submitter_project + ')';
            }

            return project_display;
            }
        },
        { data: 'created' },
        { data: 'requested_services' },
        { data: 'sample_type' },
        { data: 'received' },
        {
          data: 'latest_workflow_execution.workflow.workflow_name',
          defaultContent: '',
        },
        {
          data: 'latest_workflow_execution.modified',
          defaultContent: '',
        },
        {
          data: 'latest_workflow_execution.status',
          render: function (data, type, row, meta) {
            if (type === 'display') {
              if (data === '' || data === undefined){
                return '';
              }
              var cssClass = '';
              if (data === 'FAIL') {
                cssClass = 'bg-danger';
              } else if (data === 'COMPLETE') {
                cssClass = 'bg-success';
              } else if (data === 'IN_PROGRESS') {
                cssClass = 'bg-warning text-dark';
              }
              return '<span class="badge ' + cssClass + '">' + data + '</span>';
            }
            return data;
          },
          defaultContent: '',
        },

      ],
      language: {
        search: 'Search all fields:',
      },
      dom: '<lf<t>ipB>',
      buttons: [
        'copy', 'csv', 'print'
      ],
      initComplete: function () {
        // Apply the search
        this.api()
          .columns()
          .every(function () {
            var that = this;

            $('input', this.footer()).on('keyup change clear', function () {
              if (that.search() !== this.value) {
                that.search(this.value).draw();
              }
            });
          });
      },
    });
  });
</script>
{% endblock %}
